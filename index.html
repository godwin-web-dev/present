<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlipClock Countdown</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <!-- FlipClock Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flipclock/0.7.8/flipclock.min.js"></script>    
    <!-- Added Google Fonts for better typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html, body {
        height: 100%;
        overflow: hidden;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #f0f0f0;
      }
      .clock {
        margin: 0;
      }
      /* Linux terminal modal overrides */
      #terminal-modal {
        font-family: 'Fira Mono', 'Consolas', 'Menlo', 'Monaco', monospace !important;
        text-align: left !important;
      }
      #terminal-modal input {
        background: transparent;
        border: none;
        color: #33ff33;
        font-size: 1.1rem;
        font-family: inherit;
        outline: none;
        width: 180px;
        margin-right: 8px;
      }
      .terminal-heading {
        color: #fff;
        font-size: 1.2rem;
        margin-bottom: 12px;
        letter-spacing: 1px;
        font-family: 'Fira Mono','Consolas','Menlo','Monaco',monospace;
      }
      .terminal-lastlogin {
        color: #33ff33;
        font-size: 1rem;
        margin-bottom: 24px;
        font-family: 'Fira Mono','Consolas','Menlo','Monaco',monospace;
      }
      .terminal-message {
        margin-top: 24px;
        color: #fff;
        font-size: 1.1rem;
        min-height: 1.5em;
        font-family: 'Fira Mono','Consolas','Menlo','Monaco',monospace;
        white-space: pre-line;
      }
    </style>
  </head>
  <body>
    <!-- Dark/Light mode toggle button -->
    <div class="mode-toggle-container">
      <button id="mode-toggle" class="mode-toggle-btn" title="Toggle dark/light mode">üåô</button>
    </div>
    <div class="clock"></div>

    <!-- Linux Terminal-style Password Modal (hidden by default, shown by flip countdown JS) -->
    <div id="terminal-modal" style="position:fixed;top:0;left:0;width: 100vw !important;;height:100vh;background:#000000;z-index:99999;display:none;">
      <div style="background:#000000;padding:16px 12px 20px 12px;border-radius:8px;max-width:600px;width:90vw;margin:0px;">
        <div class="terminal-lastlogin">
          Last login: Fri Dec 19 00:00:00 IST 2025 from Godwin
        </div>
        <form id="password-form" autocomplete="off">
          <div style="display:flex;align-items:center;font-size:1.1rem;margin-bottom:16px;font-family:'Fira Mono','Consolas','Menlo','Monaco',monospace;background-color: #000000">
            <span style="color:#33ff33;margin-right:8px;white-space:pre;">-bash-5.1$</span>
            <label for="password" style="display:none;">Enter password</label>
<input
              type="password"
              id="terminal-input"
              name="terminal-input"
              autofocus
              required
            />
          </div>
        </form>
        <div id="terminal-message" class="terminal-message"></div>
      </div>
    </div>

    <script type="text/javascript">
    var clock;
    $(document).ready(function() {
      // Dark/Light mode toggle logic
      var isDark = false;
      var $toggleBtn = $('#mode-toggle');
      function setMode(dark) {
        if (dark) {
          $('body').addClass('dark-mode');
          $toggleBtn.text('‚òÄÔ∏è');
        } else {
          $('body').removeClass('dark-mode');
          $toggleBtn.text('üåô');
        }
      }
      $toggleBtn.on('click', function() {
        isDark = !isDark;
        setMode(isDark);
      });
      // Optionally, set initial mode based on system preference
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        isDark = true;
        setMode(true);
      }

      // Set countdown to 2 minutes (120 seconds)
      var secondsLeft = 10;

      // Ensure .clock exists and FlipClock library is loaded
      if ($('.clock').length === 0) {
        console.error('Clock container not found!');
        $('body').append('<div style="color:red;font-size:20px;text-align:center;">Error: Clock container not found!</div>');
        return;
      }
      if (typeof FlipClock === 'undefined') {
        console.error('FlipClock library not loaded!');
        $('body').append('<div style="color:red;font-size:20px;text-align:center;">Error: FlipClock library not loaded!</div>');
        return;
      }

      try {
        // Instantiate countdown clock
        clock = new FlipClock($('.clock'), secondsLeft, {
          clockFace: 'HourlyCounter',
          autoStart: true,
          countdown: true,
          callbacks: {
            stop: function() {
              // Show Linux terminal modal when countdown finishes
              if (clock.getTime().time === 0) {
                // Hide countdown and mode toggle
                document.querySelector('.clock').style.display = "none";
                var modeToggle = document.querySelector('.mode-toggle-container');
                if (modeToggle) modeToggle.style.display = "none";
                document.getElementById('terminal-modal').style.display = "flex";
                document.body.style.overflow = "hidden";
                setTimeout(function() {
                  document.getElementById('terminal-input').focus();
                }, 100);
              }
            }
          }
        });
      } catch (e) {
        console.error('FlipClock initialization error:', e);
        $('body').append('<div style="color:red;font-size:20px;text-align:center;">Error initializing FlipClock: ' + e + '</div>');
        return;
      }

      // Hide default labels
      $('.flip-clock-label').css('display', 'none');

      // Remove any previous custom labels
      $('.custom-clock-label').remove();

      // Group every two digit <ul> into a .digit-group and add label
      setTimeout(function() {
        var labels = ['Hours', 'Minutes', 'Seconds'];
        var $uls = $('.flip-clock-wrapper ul');
        for (var i = 0; i < $uls.length; i += 2) {
          // Create group wrapper
          var $group = $('<div class="digit-group"></div>');
          // Move two <ul> into group
          $uls.eq(i).before($group);
          $group.append($uls.eq(i));
          $group.append($uls.eq(i + 1));
          // Add label
          var labelText = labels[Math.floor(i / 2)];
          $group.append('<div class="custom-clock-label">' + labelText + '</div>');
          // Add colon after each group except the last
          if (i + 2 < $uls.length) {
            $group.after('<span class="card-colon">:</span>');
          }
        }
        // Remove all dividers (dots/colons between digit groups)
        $('.flip-clock-divider').remove();
      }, 500);

      // Terminal modal logic
      var passwordForm = document.getElementById('password-form');
      var terminalInput = document.getElementById('terminal-input');
      var terminalMessage = document.getElementById('terminal-message');
      if (passwordForm) {
        passwordForm.addEventListener('submit', function(e) {
          e.preventDefault();
          var input = terminalInput.value.trim();
          if (input === "191201") {
            terminalMessage.style.color = "#33ff33";
            terminalMessage.textContent = "Access granted. Redirecting...";
            setTimeout(function() {
              window.location.href = "present/index.html";
            }, 900);
          } else {
            terminalMessage.style.color = "#ff3333";
            terminalMessage.textContent = "Access denied. Incorrect password.";
            terminalInput.value = "";
            terminalInput.focus();
          }
        });
        terminalInput.addEventListener('input', function() {
          terminalMessage.textContent = "";
        });
      }
    });
    </script>
  </body>
</html>
